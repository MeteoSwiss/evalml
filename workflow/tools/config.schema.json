{
  "$defs": {
    "Dates": {
      "description": "Start/stop of the hindcast period and the launch frequency.",
      "properties": {
        "start": {
          "description": "First forecast initialisation as an ISO-8601 formatted string.",
          "title": "Start",
          "type": "string"
        },
        "end": {
          "description": "Last forecast initialisation as an ISO-8601 formatted string.",
          "title": "End",
          "type": "string"
        },
        "frequency": {
          "description": "Time between initialisations. Must be a combination of a number and a time unit (h or d).",
          "pattern": "^\\d+[hd]$",
          "title": "Frequency",
          "type": "string"
        }
      },
      "required": [
        "start",
        "end",
        "frequency"
      ],
      "title": "Dates",
      "type": "object"
    },
    "DefaultResources": {
      "description": "Default resource settings for job execution.",
      "properties": {
        "slurm_partition": {
          "description": "SLURM partition to use.",
          "title": "Slurm Partition",
          "type": "string"
        },
        "cpus_per_task": {
          "description": "Number of CPUs per task.",
          "minimum": 1,
          "title": "Cpus Per Task",
          "type": "integer"
        },
        "mem_mb_per_cpu": {
          "description": "Memory per CPU in MB.",
          "minimum": 1,
          "title": "Mem Mb Per Cpu",
          "type": "integer"
        },
        "runtime": {
          "description": "Maximum runtime, e.g. '1h'.",
          "title": "Runtime",
          "type": "string"
        }
      },
      "required": [
        "slurm_partition",
        "cpus_per_task",
        "mem_mb_per_cpu",
        "runtime"
      ],
      "title": "DefaultResources",
      "type": "object"
    },
    "Execution": {
      "description": "Configuration for the execution of the experiment.",
      "properties": {
        "run_group_size": {
          "description": "Number of runs to execute in the same SLURM job.",
          "minimum": 1,
          "title": "Run Group Size",
          "type": "integer"
        }
      },
      "required": [
        "run_group_size"
      ],
      "title": "Execution",
      "type": "object"
    },
    "ExplicitDates": {
      "description": "Explicit list of initialisation dates as ISO-8601 formatted strings.",
      "items": {
        "type": "string"
      },
      "title": "ExplicitDates",
      "type": "array"
    },
    "Locations": {
      "description": "Locations of data and services used in the workflow.",
      "properties": {
        "output_root": {
          "description": "Root directory for all output files.",
          "format": "path",
          "title": "Output Root",
          "type": "string"
        },
        "mlflow_uri": {
          "description": "MLflow tracking URI(s) for the experiment. Can be a list of URIs if using multiple tracking servers.",
          "items": {
            "format": "uri",
            "maxLength": 2083,
            "minLength": 1,
            "type": "string"
          },
          "title": "Mlflow Uri",
          "type": "array"
        }
      },
      "required": [
        "output_root",
        "mlflow_uri"
      ],
      "title": "Locations",
      "type": "object"
    },
    "Profile": {
      "description": "Workflow execution profile.",
      "properties": {
        "executor": {
          "description": "Job executor, e.g. 'slurm'.",
          "title": "Executor",
          "type": "string"
        },
        "default_resources": {
          "$ref": "#/$defs/DefaultResources"
        },
        "jobs": {
          "description": "Maximum number of parallel jobs.",
          "minimum": 1,
          "title": "Jobs",
          "type": "integer"
        }
      },
      "required": [
        "executor",
        "default_resources",
        "jobs"
      ],
      "title": "Profile",
      "type": "object"
    },
    "RunConfig": {
      "description": "Single training run stored in MLflow.",
      "properties": {
        "run_id": {
          "description": "The mlflow run ID, as a 32-character hexadecimal string.",
          "maxLength": 32,
          "minLength": 32,
          "title": "Run Id",
          "type": "string"
        },
        "label": {
          "description": "The label for the run that will be used in experiment results such as reports and figures.",
          "title": "Label",
          "type": "string"
        }
      },
      "required": [
        "run_id",
        "label"
      ],
      "title": "RunConfig",
      "type": "object"
    }
  },
  "additionalProperties": false,
  "description": "Top-level configuration.",
  "properties": {
    "description": {
      "description": "Description of the experiment, e.g. 'Hindcast of the 2023 season.'",
      "title": "Description",
      "type": "string"
    },
    "dates": {
      "anyOf": [
        {
          "$ref": "#/$defs/Dates"
        },
        {
          "$ref": "#/$defs/ExplicitDates"
        }
      ],
      "title": "Dates"
    },
    "lead_time": {
      "description": "Forecast length, e.g. '120h'",
      "pattern": "^\\d+[hmd]$",
      "title": "Lead Time",
      "type": "string"
    },
    "runs": {
      "additionalProperties": {
        "$ref": "#/$defs/RunConfig"
      },
      "title": "Runs",
      "type": "object"
    },
    "baseline": {
      "description": "The label of the NWP baseline run to compare against.",
      "title": "Baseline",
      "type": "string"
    },
    "execution": {
      "$ref": "#/$defs/Execution"
    },
    "locations": {
      "$ref": "#/$defs/Locations"
    },
    "profile": {
      "$ref": "#/$defs/Profile"
    }
  },
  "required": [
    "description",
    "dates",
    "lead_time",
    "runs",
    "baseline",
    "execution",
    "locations",
    "profile"
  ],
  "title": "ExperimentConfig",
  "type": "object"
}
