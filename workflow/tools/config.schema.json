{
  "$defs": {
    "Dates": {
      "description": "Start/stop of the hindcast period and the launch frequency.",
      "properties": {
        "start": {
          "description": "First forecast initialisation as an ISO-8601 formatted string.",
          "title": "Start",
          "type": "string"
        },
        "end": {
          "description": "Last forecast initialisation as an ISO-8601 formatted string.",
          "title": "End",
          "type": "string"
        },
        "frequency": {
          "description": "Time between initialisations. Must be a combination of a number and a time unit (h or d).",
          "pattern": "^\\d+[hd]$",
          "title": "Frequency",
          "type": "string"
        }
      },
      "required": [
        "start",
        "end",
        "frequency"
      ],
      "title": "Dates",
      "type": "object"
    },
    "DefaultResources": {
      "description": "Default resource settings for job execution.",
      "properties": {
        "slurm_partition": {
          "description": "SLURM partition to use.",
          "title": "Slurm Partition",
          "type": "string"
        },
        "cpus_per_task": {
          "description": "Number of CPUs per task.",
          "minimum": 1,
          "title": "Cpus Per Task",
          "type": "integer"
        },
        "mem_mb_per_cpu": {
          "description": "Memory per CPU in MB.",
          "minimum": 1,
          "title": "Mem Mb Per Cpu",
          "type": "integer"
        },
        "runtime": {
          "description": "Maximum runtime, e.g. '1h'.",
          "title": "Runtime",
          "type": "string"
        }
      },
      "required": [
        "slurm_partition",
        "cpus_per_task",
        "mem_mb_per_cpu",
        "runtime"
      ],
      "title": "DefaultResources",
      "type": "object"
    },
    "Execution": {
      "description": "Configuration for the execution of the experiment.",
      "properties": {
        "run_group_size": {
          "description": "Number of runs to execute in the same SLURM job.",
          "minimum": 1,
          "title": "Run Group Size",
          "type": "integer"
        }
      },
      "required": [
        "run_group_size"
      ],
      "title": "Execution",
      "type": "object"
    },
    "ExplicitDates": {
      "description": "Explicit list of initialisation dates as ISO-8601 formatted strings.",
      "items": {
        "type": "string"
      },
      "title": "ExplicitDates",
      "type": "array"
    },
    "ForecasterConfig": {
      "description": "Single training run stored in MLflow.",
      "properties": {
        "run_id": {
          "description": "The mlflow run ID, as a 32-character hexadecimal string.",
          "maxLength": 32,
          "minLength": 32,
          "title": "Run Id",
          "type": "string"
        },
        "label": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "The label for the run that will be used in experiment results such as reports and figures.",
          "title": "Label"
        },
        "config": {
          "anyOf": [
            {
              "additionalProperties": true,
              "type": "object"
            },
            {
              "type": "string"
            }
          ],
          "description": "Configuration for the forecaster run. Can be a dictionary of parameters or a path to a configuration file.By default, it will point to resources/inference/configs/forecaster.yaml in the evalml repository.",
          "title": "Config"
        }
      },
      "required": [
        "run_id"
      ],
      "title": "ForecasterConfig",
      "type": "object"
    },
    "ForecasterItem": {
      "properties": {
        "forecaster": {
          "$ref": "#/$defs/ForecasterConfig"
        }
      },
      "required": [
        "forecaster"
      ],
      "title": "ForecasterItem",
      "type": "object"
    },
    "InterpolatorConfig": {
      "description": "Single training run stored in MLflow.",
      "properties": {
        "run_id": {
          "description": "The mlflow run ID, as a 32-character hexadecimal string.",
          "maxLength": 32,
          "minLength": 32,
          "title": "Run Id",
          "type": "string"
        },
        "label": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "The label for the run that will be used in experiment results such as reports and figures.",
          "title": "Label"
        },
        "config": {
          "anyOf": [
            {
              "additionalProperties": true,
              "type": "object"
            },
            {
              "type": "string"
            }
          ],
          "description": "Configuration for the interpolator run. Can be a dictionary of parameters or a path to a configuration file. By default, it will point to resources/inference/configs/interpolator.yaml in the evalml repository.",
          "title": "Config"
        },
        "forecaster": {
          "$ref": "#/$defs/ForecasterConfig",
          "description": "Configuration for the forecaster run that this interpolator is based on."
        }
      },
      "required": [
        "run_id",
        "forecaster"
      ],
      "title": "InterpolatorConfig",
      "type": "object"
    },
    "InterpolatorItem": {
      "properties": {
        "interpolator": {
          "$ref": "#/$defs/InterpolatorConfig"
        }
      },
      "required": [
        "interpolator"
      ],
      "title": "InterpolatorItem",
      "type": "object"
    },
    "Locations": {
      "description": "Locations of data and services used in the workflow.",
      "properties": {
        "output_root": {
          "description": "Root directory for all output files.",
          "title": "Output Root",
          "type": "string"
        },
        "mlflow_uri": {
          "description": "MLflow tracking URI(s) for the experiment. Can be a list of URIs if using multiple tracking servers.",
          "items": {
            "type": "string"
          },
          "title": "Mlflow Uri",
          "type": "array"
        }
      },
      "required": [
        "output_root",
        "mlflow_uri"
      ],
      "title": "Locations",
      "type": "object"
    },
    "Profile": {
      "description": "Workflow execution profile.",
      "properties": {
        "executor": {
          "description": "Job executor, e.g. 'slurm'.",
          "title": "Executor",
          "type": "string"
        },
        "default_resources": {
          "$ref": "#/$defs/DefaultResources"
        },
        "jobs": {
          "description": "Maximum number of parallel jobs.",
          "minimum": 1,
          "title": "Jobs",
          "type": "integer"
        }
      },
      "required": [
        "executor",
        "default_resources",
        "jobs"
      ],
      "title": "Profile",
      "type": "object"
    },
    "VerifConfig": {
      "description": "Configuration for the verification of the experiment.",
      "properties": {
        "valid_every": {
          "anyOf": [
            {
              "minimum": 1,
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "description": "Hours between verification times starting from 00:00 UTC. If None, no filtering is applied.",
          "title": "Valid Every"
        }
      },
      "required": [
        "valid_every"
      ],
      "title": "VerifConfig",
      "type": "object"
    }
  },
  "additionalProperties": false,
  "description": "Top-level configuration.",
  "properties": {
    "description": {
      "description": "Description of the experiment, e.g. 'Hindcast of the 2023 season.'",
      "title": "Description",
      "type": "string"
    },
    "dates": {
      "anyOf": [
        {
          "$ref": "#/$defs/Dates"
        },
        {
          "$ref": "#/$defs/ExplicitDates"
        }
      ],
      "title": "Dates"
    },
    "lead_time": {
      "description": "Forecast length, e.g. '120h'",
      "pattern": "^\\d+[hmd]$",
      "title": "Lead Time",
      "type": "string"
    },
    "runs": {
      "description": "Dictionary of runs to execute, with run IDs as keys and configurations as values.",
      "items": {
        "anyOf": [
          {
            "$ref": "#/$defs/ForecasterItem"
          },
          {
            "$ref": "#/$defs/InterpolatorItem"
          }
        ]
      },
      "title": "Runs",
      "type": "array"
    },
    "baseline": {
      "description": "The label of the NWP baseline run to compare against.",
      "title": "Baseline",
      "type": "string"
    },
    "verification": {
      "anyOf": [
        {
          "$ref": "#/$defs/VerifConfig"
        },
        {
          "type": "null"
        }
      ],
      "default": null
    },
    "execution": {
      "$ref": "#/$defs/Execution"
    },
    "locations": {
      "$ref": "#/$defs/Locations"
    },
    "profile": {
      "$ref": "#/$defs/Profile"
    }
  },
  "required": [
    "description",
    "dates",
    "lead_time",
    "runs",
    "baseline",
    "execution",
    "locations",
    "profile"
  ],
  "title": "ConfigModel",
  "type": "object"
}
